<p-toast></p-toast>
<p-confirmdialog [style]="{ width: '450px' }"></p-confirmdialog>
<app-loading-spinner [loading]="loading" />
<div *ngIf="!loading">
  <p-table #dt [value]="rows" [exportFilename]="exportFileName" [rows]="10" [columns]="cols" [paginator]="true"
    [rowHover]="true" dataKey="orgId" [tableStyle]="{ 'min-width': '72rem' }" [rowsPerPageOptions]="[10,20,30]"
    [showCurrentPageReport]="true"
    [currentPageReportTemplate]="'Showing {first} to {last} of {totalRecords} organizations'"
    [globalFilterFields]="['organizationName','industryName','countryName','regionName','telephone1','telephone2']">

    <!-- CAPTION + TOOLBAR -->
    <ng-template pTemplate="caption">
      <div class="flex items-center justify-between">
        <h5 class="m-0">Organizations</h5>
      </div>
      <div class="search-filters flex flex-wrap gap-3 mb-4">

        <!-- Industry -->
        <div class="flex align-items-center gap-2" style="min-width: 220px;">
          <label class="w-7rem text-right text-sm mt-1">Industry:</label>
          <p-autoComplete [(ngModel)]="industrySelectedAutoValue" [suggestions]="industryAutoFiltered"
            (onSelect)="onIndustrySelect($event.value)" (onClear)="onIndustryClear()" required="ture"
            (completeMethod)="filterIndustryList($event)" [dropdown]="true" field="name" optionLabel="name"
            [appendTo]="'body'" [showClear]="true" placeholder="Search Industries" class="w-full">
          </p-autoComplete>
        </div>

        <!-- Telephone 1 -->
        <div class="flex align-items-center gap-2" style="min-width: 220px;">
          <label class="w-7rem text-right text-sm mt-1">Telephone1:</label>
          <input pInputText [(ngModel)]="searchFilter.telephone1" class="w-full" />
        </div>


        <!-- Organization -->
        <div class="flex align-items-center gap-2" style="min-width: 220px;">
          <label class="w-7rem text-right text-sm mt-1">Organization:</label>
          <input pInputText [(ngModel)]="searchFilter.organizationName" class="w-full" />
        </div>

        <!-- Telephone 2 -->
        <div class="flex align-items-center gap-2" style="min-width: 220px;">
          <label class="w-7rem text-right text-sm mt-1">Telephone2:</label>
          <input pInputText [(ngModel)]="searchFilter.telephone2" class="w-full" />
        </div>
        <!-- Country -->
        <div class="flex align-items-center gap-2" style="min-width: 220px;">
          <label class="w-5rem text-right text-sm mt-1">Country:</label>
          <!-- <input pInputText [(ngModel)]="searchFilter.countryName" class="w-full" /> -->
          <p-autoComplete [(ngModel)]="countrySelectedAutoValue" [suggestions]="countryAutoFiltered"
            (onSelect)="onCountrySelect($event.value)" (onClear)="onCountryClear()" required="ture"
            (completeMethod)="filterCountryList($event)" [dropdown]="true" field="name" optionLabel="name"
            [appendTo]="'body'" [showClear]="true" placeholder="Search Countries" class="w-full">
          </p-autoComplete>

        </div>


        <!-- Region -->
        <div class="flex align-items-center gap-2 ml-1.5" style="min-width: 220px;">
          <label class="w-5rem text-right text-sm mt-1">Region:</label>
          <!-- <input pInputText [(ngModel)]="searchFilter.regionName" class="w-full" /> -->
          <p-autoComplete [(ngModel)]="regionSelectedAutoValue" [suggestions]="regionAutoFiltered"
            (onSelect)="onRegionSelect($event.value)" (onClear)="onRegionClear()" required="ture"
            (completeMethod)="filterRegionList($event)" [dropdown]="true" field="name" optionLabel="name"
            [appendTo]="'body'" [showClear]="true" placeholder="Search Regions" class="w-full">
          </p-autoComplete>
        </div>
      </div>



      <p-toolbar styleClass="mb-2">
        <ng-template pTemplate="start">
          <button pButton type="button" class="mr-2" icon="pi pi-plus" label="New" (click)="onAddGroup()"></button>
          <button pButton type="button" icon="pi pi-save" label="Export CSV" (click)="exportCSV()"></button>
        </ng-template>

        <ng-template pTemplate="end">
          <!-- <p-iconField>
            <p-inputIcon styleClass="pi pi-search"></p-inputIcon>
            <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Search" />
          </p-iconField> -->
          <p-button label="Search" icon="pi pi-search" (onClick)="applyFilters()" class="mr-2"></p-button>
          <p-button label="Reset" icon="pi pi-refresh" (onClick)="clearFilters()"></p-button>

        </ng-template>

      </p-toolbar>
    </ng-template>

    <!-- HEADER -->
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="organizationName" style="min-width:18rem">
          Organization <p-sortIcon field="organizationName" />
        </th>
        <th pSortableColumn="industryName" style="min-width:14rem">
          Industry <p-sortIcon field="industryName" />
        </th>
        <th pSortableColumn="countryName" style="min-width:12rem">
          Country <p-sortIcon field="countryName" />
        </th>
        <th pSortableColumn="regionName" style="min-width:12rem">
          Region <p-sortIcon field="regionName" />
        </th>
        <th pSortableColumn="telephone1" style="min-width:10rem">
          Telephone 1 <p-sortIcon field="telephone1" />
        </th>
        <th pSortableColumn="telephone2" style="min-width:10rem">
          Telephone 2 <p-sortIcon field="telephone2" />
        </th>
        <th style="min-width:8rem">Actions</th>
      </tr>
    </ng-template>

    <!-- BODY -->
    <ng-template pTemplate="body" let-g>
      <tr>
        <td>{{ g.organizationName }}</td>
        <td>{{ g.industryName || '' }}</td>
        <td>{{ g.countryName || '' }}</td>
        <td>{{ g.regionName || '' }}</td>
        <td>{{ g.telephone1 || '' }}</td>
        <td>{{ g.telephone2 || '' }}</td>
        <td class="flex gap-2">
          <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-outlined mr-2" (click)="onEditGroup(g)">
          </button>

          <button pButton icon="pi pi-trash" class="p-button-danger p-button-rounded p-button-outlined"
            (click)="deleteOrg(g)">
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Dialog -->
<p-dialog [(visible)]="groupDialog" [header]="editing ? 'Edit | Organization' : 'Add | Organization'" [modal]="true"
  [draggable]="false" [resizable]="true" [closable]="false" [dismissableMask]="true"
  [style]="{ width: '1080px', maxWidth: '96vw' }" styleClass="sg-dialog">

  <ng-template pTemplate="content">
    <ng-container *ngIf="form2">
      <div class="sg-form">
        <div class="sg-row sg-grid-2">
          <div class="sg-field">
            <label class="sg-label">* Organization Name:</label><br />
            <input pInputText class="w-full" [(ngModel)]="form2.organizationName" name="organizationName" required />
            <!-- <small class="p-error" *ngIf="submitted && !form?.organizationName">
              Organization name is required
            </small> -->
          </div>

          <div class="sg-field">
            <label class="sg-label">* Industry:</label><br />
            <!-- <input pInputText class="w-full" [(ngModel)]="form2.ind" name="industryName" /> -->
            <p-autoComplete [(ngModel)]="industrySelectedAutoValue" [suggestions]="industryAutoFiltered"
              (onSelect)="onIndustrySelect($event.value)" (onClear)="onIndustryClear()"
              (completeMethod)="filterIndustryList($event)" [dropdown]="true" field="name" optionLabel="name"
              [appendTo]="'body'" [showClear]="true" placeholder="Search Industries" class="w-full">
            </p-autoComplete>
          </div>
        </div>

        <br />

        <div class="sg-row sg-grid-2">
          <div class="sg-field">
            <label class="sg-label">* Country:</label><br />
            <!-- <input pInputText class="w-full" [(ngModel)]="form.countryName" name="countryName" /> -->
            <p-autoComplete [(ngModel)]="countrySelectedAutoValue" [suggestions]="countryAutoFiltered"
              (onSelect)="onCountrySelect($event.value)" (onClear)="onCountryClear()"
              (completeMethod)="filterCountryList($event)" [dropdown]="true" field="name" optionLabel="name"
              [appendTo]="'body'" [showClear]="true" placeholder="Search Countries" class="w-full">
            </p-autoComplete>

          </div>
          <div class="sg-field">
            <label class="sg-label">* Region:</label><br />
            <!-- <input pInputText class="w-full" [(ngModel)]="form.regionName" name="regionName" /> -->
            <p-autoComplete [(ngModel)]="regionSelectedAutoValue" [suggestions]="regionAutoFiltered"
              (onSelect)="onRegionSelect($event.value)" (onClear)="onRegionClear()"
              (completeMethod)="filterRegionList($event)" [dropdown]="true" field="name" optionLabel="name"
              [appendTo]="'body'" [showClear]="true" placeholder="Search Regions" class="w-full">
            </p-autoComplete>
          </div>
        </div>

        <br />

        <div class="sg-row sg-grid-2">
          <div class="sg-field">
            <label class="sg-label">Telephone 1:</label><br />
            <input pInputText class="w-full" [(ngModel)]="form2.telephone1" name="telephone1" />
          </div>
          <div class="sg-field">
            <label class="sg-label">Telephone 2:</label><br />
            <input pInputText class="w-full" [(ngModel)]="form2.telephone2" name="telephone2" />
          </div>
        </div>
      </div>
    </ng-container>
  </ng-template>

  <ng-template pTemplate="footer">
    <div class="sg-footer">
      <p-button label="Cancel" icon="pi pi-times" styleClass="p-button-text" (onClick)="hideGroupDialog()"></p-button>
      <p-button [label]="editing ? 'Update' : 'Save'" icon="pi pi-check" [disabled]="saving()"
        (onClick)="saveGroup()"></p-button>
    </div>
  </ng-template>
</p-dialog>